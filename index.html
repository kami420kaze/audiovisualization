<!DOCTYPE html>
<html>
 <head>
  <title>Wallpaper</title>
  <style>
    html, body {
     width: 100vw;
     height: 100vh;
     margin: 0;
     padding: 0;
     overflow: hidden;
     background: #222;
    }
  </style>
  <script>
   window.addEventListener('load', _ => {
        let audio = []

        const bar = {
            width: window.innerWidth / 128 - 8,
            height: 100,
            padding: 8
        }
        
        const canvas = document.createElement('canvas')
        const context = canvas.getContext('2d')

        canvas.width = window.innerWidth
        canvas.height = window.innerHeight

        document.body.appendChild(canvas)

        const listener = arr => {
            audio = arr
        }

        const draw = _ => {
            context.fillStyle = '#fff'
            context.clearRect(0, 0, window.innerWidth, window.innerHeight)

            for (const [i, part] of audio.entries()) {
                const x = (i * bar.width) + ((i + 1) * bar.padding) - (bar.padding / 2)
                const y = 4
                context.fillRect(x, y, bar.width, bar.height * part)
            }

            requestAnimationFrame(draw)
        }

        window.wallpaperRegisterAudioListener(listener)
        draw()
   })
  </script>
 </head>
 <body>
 </body>
</html>